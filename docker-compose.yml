version: '3.8'

services:
  app:
    image: ${IMAGE_TAG}
    container_name: feishu-minute-app
    restart: always
    ports:
      - "29090:29090"
    volumes:
      - ./downloads:/app/downloads
      - ./user_token:/app/user_token
      - ./logs:/app/logs
      # 挂载 NAS 存储池
      - /vol1:/nas_data
      # 挂载用户配置文件，以便容器能识别 NAS 用户名 (UID->Name)
      - /etc/passwd:/etc/passwd:ro
      - /etc/group:/etc/group:ro
      - /etc/localtime:/etc/localtime:ro
    env_file:
      - .env
    # 健康检查 (可选，确保服务真正启动)
    # healthcheck:
    #   test: ["CMD", "curl", "-f", "http://localhost:29090/auth/start"]
    #   interval: 1m
    #   timeout: 10s
    #   retries: 3
